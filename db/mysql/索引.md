## 索引的本质
一种高效读取数据的排好序的数据结构，MySQL使用B+树来存储这些数据。

## 索引的数据结构

### 红黑树
红黑树是一般树的一种优化，一般树存在一个问题。在特殊的情况下可能会退化成链表，即所有的叶子节点都在树的同一侧。红黑树使用自旋的方式做平衡，使节点两侧高度不大于1。单红黑树也存在问题，即树的高度不可控。树的高度可能会非常深，搜索的效率下降。

### B树与B+树
B树与B+树，是红黑树的改良，单节点内存放多元素，使节点的高度可控。

> B树
![[Pasted image 20210315094005.png]]

> B+树
![[Pasted image 20210315094112.png]]


B+树是对B树的一种优化，B+树的是将所有的的数据都放在的末端的叶子节点当中。上层的节点数据都可以加载到内存中快速搜索，并且占用内存小。MySQL中一个节点的默认大小为16kb。

MySQL中查看节点大小：
`SHOW GLOBAL STATUS LIKE 'Innodb_page_size'`

## 存储引擎
MySQL中的存储引擎作用于数据库中的表，而不是库，即表的类型不同。
myisam和innodb都是以B+树作为底层数据结构进行存储。

### myisam

> myisam表存储结构 （非聚集、离散索引）
![[Pasted image 20210315190848.png]]

所有的叶子节点存储的是具体数据的位置，而不是具体的数值。

### innodb

> innodb表存储结构 （集聚索引）
![[Pasted image 20210315191231.png]]

所有叶子节点包含了完整的数据记录，而不是数据地址。



## mysql下的索引种类

### B+ Tree 索引
InnoDB 的 B+Tree 索引分为主索引和辅助索引。主索引的叶子节点 data 域记录着完整的数据记录，这种索引方式被称为聚簇索引。因为无法把数据行存放在两个不同的地方，所以一个表只能有一个聚簇索引。

辅助索引的叶子节点的 data 域记录着主键的值，因此在使用辅助索引进行查找时，需要先查找到主键值，然后再到主索引中进行查找，这个过程也被称作回表。

### 哈希索引
哈希索引能以 O(1) 时间进行查找，但是失去了有序性：

-   无法用于排序与分组
-   只支持精确查找，无法用于部分查找和范围查找

InnoDB 存储引擎有一个特殊的功能叫“自适应哈希索引”，当某个索引值被使用的非常频繁时，会在 B+Tree 索引之上再创建一个哈希索引，这样就让 B+Tree 索引具有哈希索引的一些优点，比如快速的哈希查找。

### 全文索引
### 空间数据索引

## innodb下的索引的种类

### 联合索引

联合索引是一个有序的数据结构，从字段的第一个开始。在查询的时候必须从索引字段的第一个开始。

> 联合索引结构
![[Pasted image 20210315192713.png]]

建立一个关于`name, age, position`的联合索引，在查询的时候`where`条件必须从`name`开始，这个就是最左前缀发展。